<!doctype html>
<html lang="th" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TPN Calculator - Pediatric | ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏®‡∏£‡∏µ‡∏ô‡∏Ñ‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      font-family: 'Sarabun', 'Inter', sans-serif;
    }
    
    .gradient-header {
      background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 50%, #3d7ab5 100%);
    }
    
    .card-shadow {
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    
    .input-focus:focus {
      outline: none;
      ring: 2px;
      ring-color: #3b82f6;
      border-color: #3b82f6;
    }
    
    .section-title {
      position: relative;
      padding-left: 12px;
    }
    
    .section-title::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 4px;
      height: 100%;
      background: linear-gradient(180deg, #3b82f6, #1d4ed8);
      border-radius: 2px;
    }
    
    .result-highlight {
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      border-left: 4px solid #0ea5e9;
    }
    
    .warning-box {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-left: 4px solid #f59e0b;
    }
    
    .success-box {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      border-left: 4px solid #10b981;
    }
    
    .table-header {
      background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%);
    }
    
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    
    input[type="number"] {
      -moz-appearance: textfield;
    }
    
    .radio-custom:checked + label {
      background-color: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }
    
    .checkbox-custom:checked + label {
      background-color: #10b981;
      color: white;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-fade-in {
      animation: fadeIn 0.3s ease-out forwards;
    }
    
    .print-section {
      display: none;
    }
    
    @media print {
      .no-print {
        display: none !important;
      }
      .print-section {
        display: block !important;
      }
      body {
        font-size: 12pt;
      }
    }

    .tab-button {
      transition: all 0.3s ease;
    }

    .tab-button.active {
      background-color: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }

    .tab-button.inactive {
      background-color: white;
      color: #6b7280;
      border-color: #e5e7eb;
    }
    }
    html {
  height: auto;
}

body {
  min-height: 100vh;
  overflow-y: auto;
  overflow-x: hidden;
}

/* ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ Dropdown ‡∏Ç‡∏≠‡∏á Ward ‡∏•‡∏≠‡∏¢‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á‡πÜ */
#wardDropdown {
  z-index: 9999 !important;
}
  </style>
</head>
<body class="bg-gray-50">
  <div id="app">
    <!-- Header -->
    <header class="gradient-header text-white py-4 px-6 sticky top-0 z-50 shadow-lg no-print">
      <div class="max-w-6xl mx-auto flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm">
            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
              <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14h-2v-4H6v-2h4V7h2v4h4v2h-4v4z"/>
            </svg>
          </div>
          <div>
            <h1 id="appTitle" class="text-xl font-bold tracking-tight">TPN Calculator - Pediatric</h1>
            <p id="hospitalName" class="text-blue-100 text-sm">‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏®‡∏£‡∏µ‡∏ô‡∏Ñ‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå</p>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <button onclick="resetForm()" class="px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all text-sm font-medium backdrop-blur-sm">
            üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
          </button>
       </div>
      </div>
    </header>

    <!-- Main Content -->
<main id="mainContent" class="max-w-6xl mx-auto p-4 md:p-6 space-y-6">
      
      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in relative z-30">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <div>
  <label class="block text-sm font-medium text-gray-700 mb-1">
    ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà Order TPN <span class="text-red-600 font-bold ml-1">*‡∏Å‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á*</span>
  </label>
  <input type="date" id="orderDate" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all bg-white">
</div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">HN (‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡πÑ‡∏î‡πâ)</label>
            <input type="text" id="hn" placeholder="‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå HN" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" autofocus>
          </div>
          <div>
  <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
  <input type="text" id="patientName" placeholder="‡∏ä‡∏∑‡πà‡∏≠ ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all">
  <p id="searchStatus" class="text-[11px] mt-1 font-medium"></p> 
</div>
          <div class="relative">
            <label class="block text-sm font-medium text-gray-700 mb-1">Ward</label>
            <div class="relative">
              <input type="text" id="wardInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢..." class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" onfocus="showWardList()" oninput="filterWardList()" autocomplete="off">
              <input type="hidden" id="ward"> 
              <div id="wardDropdown" class="hidden absolute left-0 right-0 z-[100] mt-1 bg-white border border-gray-200 rounded-xl shadow-2xl max-h-60 overflow-y-auto">
                <div id="wardOptions" class="py-1"></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in relative z-10">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4"> üíâ Route ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ TPN</h2>
        <div class="flex flex-wrap gap-3">
          <input type="radio" name="route" id="central" value="central" class="hidden radio-custom" checked>
          <label for="central" class="px-6 py-3 border-2 border-gray-300 rounded-xl cursor-pointer transition-all hover:border-blue-400 font-medium flex items-center gap-2">
            <span class="text-xl">ü©∏</span> Central Line
          </label>
          <input type="radio" name="route" id="peripheral" value="peripheral" class="hidden radio-custom">
          <label for="peripheral" class="px-6 py-3 border-2 border-gray-300 rounded-xl cursor-pointer transition-all hover:border-blue-400 font-medium flex items-center gap-2">
            <span class="text-xl">ü§öüèª</span> Peripheral Line
          </label>
        </div>
      </section>

      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">üìë ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (BW)</label>
            <div class="relative">
              <input type="number" id="bw" step="0.1" min="0" placeholder="0.0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all pr-12" inputmode="decimal" oninput="calculateAll()">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">kg</span>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Total TPN Volume (‡∏£‡∏ß‡∏° Fat) ‡∏ó‡∏µ‡πà‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏Å‡∏≥‡∏´‡∏ô‡∏î</label>
            <div class="relative">
              <input type="number" id="totalVolume" step="1" min="0" placeholder="0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all pr-12" inputmode="decimal" oninput="calculateAll()">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">ml</span>
            </div>
          </div>
        </div>
      </section>

    <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
    <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">üßà ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ Fat + Vitalipid¬Æ </h2>
    
    <div class="flex flex-wrap gap-2 mb-4 p-3 bg-amber-50/50 rounded-xl border border-amber-100">
        <span class="text-sm font-bold text-amber-800 w-full mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÑ‡∏Ç‡∏°‡∏±‡∏ô:</span>
        <input type="radio" name="fatProduct" id="smof" value="smof" class="hidden radio-custom" checked onchange="calculateAll()">
        <label for="smof" class="px-4 py-2 bg-white border border-gray-300 rounded-lg cursor-pointer text-xs font-medium transition-all hover:bg-amber-50">20% SMOF Lipid</label>
        <input type="radio" name="fatProduct" id="intralipid" value="intralipid" class="hidden radio-custom" onchange="calculateAll()">
        <label for="intralipid" class="px-4 py-2 bg-white border border-gray-300 rounded-lg cursor-pointer text-xs font-medium transition-all hover:bg-amber-50">20% Intralipid</label>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Fat ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ (Fat requirement) </label>
            <div class="relative">
                <input type="number" id="fatTarget" step="0.1" min="0" placeholder="0.0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all pr-24" inputmode="decimal" oninput="calculateFatLogic('fat_dose')">
                <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 text-sm">g/kg/day</span>
            </div>
            <div class="mt-2 flex items-center gap-2 p-2 bg-amber-50 rounded-lg border border-amber-100">
                <input type="checkbox" id="deductVitalipid" class="w-4 h-4 rounded text-blue-600 cursor-pointer" onchange="calculateFatLogic('fat_dose')">
                <label for="deductVitalipid" class="text-[11px] text-gray-700 cursor-pointer font-medium">‡∏´‡∏±‡∏Å Fat ‡∏à‡∏≤‡∏Å Vitalipid¬Æ</label>
                <input type="number" id="vitalipidFatValue" step="0.01" value="0.4" class="w-14 px-1 py-0.5 border border-gray-300 rounded text-xs text-center font-bold text-blue-700" oninput="calculateFatLogic('fat_dose')">
                <span class="text-[10px] text-gray-500">g/kg</span>
            </div>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Net Fat ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</label>
            <div class="relative">
                <input type="number" id="netFat" step="0.1" class="w-full px-4 py-2.5 border border-gray-200 rounded-xl bg-gray-100 pr-24 font-semibold text-gray-600" readonly inputmode="decimal">
                <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 text-sm">g/kg/day</span>
            </div>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Fat Volume <span class="text-blue-600 italic">*‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏î‡πÄ‡∏®‡∏©*</span></label>
            <div class="relative">
                <input type="number" id="fatVolume" step="0.1" min="0" class="w-full px-4 py-2.5 border border-blue-300 rounded-xl bg-blue-50 font-bold text-blue-700 pr-12" inputmode="decimal" oninput="calculateFatLogic('fat_vol')">
                <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">ml</span>
            </div>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"> üîã Vitalipid¬Æ(Max = 10ml) </label>
            <div class="relative">
                <input type="number" id="vitalipid" step="0.1" min="0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all pr-12 font-semibold text-blue-700" inputmode="decimal" oninput="handleVitalipidManualChange()">
                <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">ml</span>
            </div>
            <p id="vitalipidMaxWarning" class="hidden text-[10px] text-red-600 mt-1 font-bold">‚ö†Ô∏è Max = 10 ml</p>
        </div>
    </div>
</section>

     <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">üíâ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ Fat</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Å‡∏≤‡∏£‡πÑ‡∏•‡πà‡∏™‡∏≤‡∏¢</label>
            <div class="space-y-2">
              <label class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                <input type="radio" name="flush" value="none" checked onchange="calculateFatAdmin()">
                <span class="text-sm">‡πÑ‡∏°‡πà‡πÑ‡∏•‡πà‡∏™‡∏≤‡∏¢</span>
              </label>
              <div class="flex items-center gap-2">
  <input type="radio" name="flush" value="custom" onchange="calculateFatAdmin()">
  <span class="text-sm font-medium text-blue-600">+</span>
  <input type="number" id="flushVolume" 
         placeholder="0" 
         class="w-20 px-3 py-1.5 border-2 border-blue-200 rounded-lg text-sm font-bold text-blue-700 bg-blue-50 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all shadow-sm" 
         inputmode="decimal" 
         oninput="isFlushManual = true; calculateFatAdmin()">
  <span class="text-xs font-semibold text-blue-600 italic">ml ‡πÑ‡∏•‡πà‡∏™‡∏≤‡∏¢</span>
</div>
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"> ‡∏£‡∏ß‡∏°‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ï‡∏£ Fat+‡πÑ‡∏•‡πà‡∏™‡∏≤‡∏¢+ Vitalipid¬Æ</label>
            <div class="relative">
              <input type="number" id="totalFatPlusVitalipid" class="w-full px-4 py-2.5 border border-gray-200 rounded-xl bg-blue-50 font-bold text-blue-700" readonly>
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 text-sm">ml</span>
            </div>
            <p class="text-[10px] text-gray-500 mt-1">(Fat + Flush + Vit)</p>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏ö‡πà‡∏á‡πÉ‡∏ô ward NICU, 2‡∏Ñ) </label>
            <div class="space-y-2">
              <label class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                <input type="radio" name="prepSplit" value="none" checked onchange="calculateFatAdmin()">
                <span class="text-sm">‡πÑ‡∏°‡πà‡πÅ‡∏ö‡πà‡∏á</span>
              </label>
              <label class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100">
                <input type="radio" name="prepSplit" value="split" onchange="calculateFatAdmin()">
                <span class="text-sm">‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° ‡πÄ‡∏õ‡πá‡∏ô 2 syr/‡∏Ç‡∏ß‡∏î</span>
              </label>
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2 whitespace-nowrap">
  Drip Rate <span id="autoFatRateLabel" class="text-blue-600 font-bold ml-1">(‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ = 0.0 ml/hr)</span>
</label>
<div class="relative">
  <input type="number" id="manualFatDripRate" step="0.1" placeholder="0.0" class="w-full px-4 py-2.5 border border-blue-300 rounded-xl focus:ring-2 focus:ring-blue-500 font-bold text-blue-700" oninput="calculateFatAdmin()">
  <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 text-sm">ml/hr</span>
</div>
          </div>
        </div>
      </section>

      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">üíß PN Volume & Rate</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">PN Volume (‡∏™‡∏∏‡∏ó‡∏ò‡∏¥)</label>
            <div class="relative">
              <input type="number" id="pnVolume" step="0.1" min="0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all pr-12 bg-gray-50 font-semibold text-gray-600" readonly>
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">ml</span>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ö‡∏ß‡∏Å‡πÑ‡∏•‡πà‡∏™‡∏≤‡∏¢</label>
            <div class="relative">
              <input type="number" id="pnFlushVolume" value="30" step="1" min="0" class="w-full px-4 py-2.5 border border-blue-300 rounded-xl input-focus transition-all pr-12 font-bold text-blue-700" oninput="calculateAll()">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">ml</span>
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">PN Volume ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°</label>
            <div class="relative">
              <input type="number" id="pnPrepVolume" step="0.1" class="w-full px-4 py-2.5 border border-green-300 rounded-xl bg-green-50 pr-12 font-bold text-green-700" readonly>
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">ml</span>
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Rate TPN (PN √∑ 24)</label>
            <div class="relative">
              <input type="number" id="rateTPN" step="0.01" class="w-full px-4 py-2.5 border border-blue-300 rounded-xl input-focus transition-all pr-16 font-bold text-blue-700" oninput="handleRateManualChange()">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">ml/hr</span>
            </div>
          </div>
        </div>
      </section>

      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">Macronutrient</h2>
        <div class="p-4 bg-purple-50 rounded-xl border border-purple-100 md:col-span-3">
  <div class="flex flex-wrap gap-2 mb-3">
    <span class="text-sm font-bold text-purple-800 w-full mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Protein Product:</span>
    <input type="radio" name="proteinProduct" id="aminoven" value="aminoven" class="hidden radio-custom" checked onchange="calculateAll()">
    <label for="aminoven" class="px-3 py-1.5 bg-white border border-gray-300 rounded-lg cursor-pointer text-xs font-medium transition-all">10% Aminoven Infant</label>
    
    <input type="radio" name="proteinProduct" id="amiparen" value="amiparen" class="hidden radio-custom" onchange="calculateAll()">
    <label for="amiparen" class="px-3 py-1.5 bg-white border border-gray-300 rounded-lg cursor-pointer text-xs font-medium transition-all">10% Amiparen</label>
    
    <input type="radio" name="proteinProduct" id="aminoplasmal" value="aminoplasmal" class="hidden radio-custom" onchange="calculateAll()">
    <label for="aminoplasmal" class="px-3 py-1.5 bg-white border border-gray-300 rounded-lg cursor-pointer text-xs font-medium transition-all">15% Aminoplasmal</label>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div>
      <label class="block text-xs font-bold text-gray-500 mb-1">Dose (g/kg/day)</label>
      <input type="number" id="proteinTarget" step="0.1" class="w-full px-4 py-2 border border-purple-200 rounded-lg font-bold text-purple-700" oninput="calculateProteinLogic('prot_dose')">
    </div>
    <div>
      <label class="block text-xs font-bold text-gray-500 mb-1">Total (g/day)</label>
      <input type="number" id="proteinGrams" step="0.1" class="w-full px-4 py-2 border border-purple-200 rounded-lg font-bold text-purple-700" oninput="calculateProteinLogic('prot_grams')">
    </div>
    <div>
      <label class="block text-xs font-bold text-gray-500 mb-1">Protein Vol (ml) <span class="text-blue-600 italic">*‡∏õ‡∏±‡∏î‡πÄ‡∏®‡∏©*</span></label>
      <input type="number" id="proteinVolInput" step="0.1" class="w-full px-4 py-2 border border-blue-300 rounded-lg font-bold text-blue-700 bg-blue-50" oninput="calculateProteinLogic('prot_vol')">
    </div>
  </div>
</div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Fat (Net Fat)</label>
            <div class="relative">
              <input type="number" id="fatDisplay" step="0.1" class="w-full px-4 py-2.5 border border-gray-200 rounded-xl bg-gray-100 pr-24 font-semibold text-gray-600" readonly inputmode="decimal">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 text-sm">g/kg/day</span>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">%Dextrose</label>
            <div class="relative">
              <input type="number" id="dextrosePercent" step="0.1" min="0" max="50" placeholder="0.0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all pr-12" inputmode="decimal" oninput="calculateAll()">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">%</span>
            </div>
          </div>
        </div>
        <div id="girContainer" class="p-4 rounded-xl result-highlight">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <span class="text-2xl">üìä</span>
              <div>
                <span class="text-sm text-gray-600">GIR (Glucose Infusion Rate)</span>
                <p class="text-xs text-gray-500 mt-0.5">= (Rate TPN √ó %Dextrose) √∑ (BW √ó 6)</p>
              </div>
            </div>
            <div class="text-right">
              <span id="girValue" class="text-2xl font-bold text-blue-700">0.00</span>
              <span class="text-gray-600 ml-1">mg/kg/min</span>
            </div>
          </div>
          <div id="girWarning" class="hidden mt-2 text-sm text-amber-700 bg-amber-100 px-3 py-2 rounded-lg">
            ‚ö†Ô∏è GIR ‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
          </div>
        </div>
      </section>

      <!-- Electrolytes Section -->
      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">‚öóÔ∏è Electrolytes</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">P (Glycophos¬Æ)</label>
            <p class="text-xs text-gray-600 mb-2">0.5-1 mEq/kg/day</p>
            <div class="relative mb-2">
              <input type="number" id="phosphorus" step="0.1" min="0" placeholder="0.0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" inputmode="decimal" oninput="calculateAll()">
            </div>
            <div class="text-xs bg-blue-50 p-2 rounded-lg border border-blue-200">
             <p class="text-gray-700">
  <strong>Vol:</strong> 
  <input type="number" id="phosvol" step="0.1" 
    class="w-16 px-1 border-b border-blue-300 bg-transparent text-blue-700 font-bold focus:outline-none" 
    oninput="isPhosVolManual = true; calculateAll()"> ml
</p>
              <p class="text-gray-700"><strong>Na from P:</strong> <input type="number" id="phoNa" step="0.1" class="w-16 px-1 border-b border-blue-300 bg-transparent text-blue-700 font-bold focus:outline-none" oninput="isPhosNaManual = true; calculateAll()"> mEq</p>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Na (3% NaCl)</label>
            <p class="text-xs text-gray-600 mb-2">2-4 mEq/kg/day</p>
            <div class="relative mb-2">
              <input type="number" id="sodium" step="0.1" min="0" placeholder="0.0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" inputmode="decimal" oninput="calculateAll()">
            </div>
            <div class="text-xs bg-blue-50 p-2 rounded-lg border border-blue-200">
             <p class="text-gray-700"><strong>Vol:</strong> <input type="number" id="navol" step="0.1" class="w-16 px-1 border-b border-blue-300 bg-transparent text-blue-700 font-bold focus:outline-none" oninput="isNaVolManual = true; calculateAll()"> ml</p>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">K (KCl)</label>
            <p class="text-xs text-gray-600 mb-2">2-4 mEq/kg/day</p>
            <div class="relative mb-2">
              <input type="number" id="potassium" step="0.1" min="0" placeholder="0.0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" inputmode="decimal" oninput="calculateAll()">
            </div>
            <div class="text-xs bg-blue-50 p-2 rounded-lg border border-blue-200">
              <p class="text-gray-700"><strong>Vol:</strong> <input type="number" id="kvol" step="0.1" class="w-16 px-1 border-b border-blue-300 bg-transparent text-blue-700 font-bold focus:outline-none" oninput="isKVolManual = true; calculateAll()"> ml</p>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Mg (50% MgSO‚ÇÑ)</label>
            <p class="text-xs text-gray-600 mb-2">0.2-0.3 mmol/kg/day</p>
            <div class="relative mb-2">
              <input type="number" id="magnesium" step="0.1" min="0" placeholder="0.0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" inputmode="decimal" oninput="calculateAll()">
            </div>
            <div class="text-xs bg-blue-50 p-2 rounded-lg border border-blue-200">
              <p class="text-gray-700"><strong>Vol:</strong> <input type="number" id="mgvol" step="0.01" class="w-16 px-1 border-b border-blue-300 bg-transparent text-blue-700 font-bold focus:outline-none" oninput="isMgVolManual = true; calculateAll()"> ml</p>
            </div>
          </div>
          <div>
  <label class="block text-sm font-medium text-gray-700 mb-1">Ca (10% Ca Gluconate)</label>
  <p class="text-xs text-gray-600 mb-2">4-6 ml/kg/day</p>
  <div class="relative mb-2">
    <input type="number" id="calcium" step="0.1" min="0" placeholder="0.0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" inputmode="decimal" oninput="calculateAll()">
  </div>
  <div class="text-xs bg-blue-50 p-2 rounded-lg border border-blue-200">
    <p class="text-gray-700"><strong>Vol:</strong> <input type="number" id="cavol" step="0.1" class="w-16 px-1 border-b border-blue-300 bg-transparent text-blue-700 font-bold focus:outline-none" oninput="isCaVolManual = true; calculateAll()"> ml</p>
  </div>
  <p id="caMaxWarning" class="hidden text-[10px] text-red-600 mt-1 font-bold">‚ö†Ô∏è Max = 10 ml</p>
</div>
          </div>
        </div>
      </section>

      <!-- Vitamins & Trace Elements Section -->
      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">üíä Vitamin & Trace Elements</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="p-4 bg-green-50 rounded-xl border border-green-200">
            <h3 class="font-semibold text-green-800 mb-3">üíâ Vitamin</h3>
            <div class="space-y-3">
              <div>
                <label class="text-sm font-medium text-gray-700 block mb-1">Soluvit¬Æ N</label>
                <div class="flex items-center gap-2">
                  <input type="number" id="soluvit" step="0.1" class="flex-1 px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" inputmode="decimal" oninput="isSoluvitManual = true; calculateAll()">
                  <span class="text-gray-600 whitespace-nowrap font-medium">ml</span>
                </div>
                <p class="text-xs text-gray-600 mt-1">= 1 √ó BW (Max 10 ml)</p>
                <p id="soluvitWarning" class="hidden text-xs text-red-600 mt-1 font-semibold">‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏ô 10 ml!</p>
              </div>
            </div>
          </div>
          <div class="p-4 bg-cyan-50 rounded-xl border border-cyan-200">
            <h3 class="font-semibold text-cyan-800 mb-3">üî¨ Trace Elements</h3>
            <div class="space-y-3">
              <div>
                <label class="text-sm font-medium text-gray-700 block mb-1">Peditrace¬Æ</label>
                <div class="flex items-center gap-2">
                  <input type="number" id="peditrace" step="0.1" class="flex-1 px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" inputmode="decimal" oninput="isPeditraceManual = true; calculateAll()">

                  <span class="text-gray-600 whitespace-nowrap font-medium">ml</span>
                </div>
                <p class="text-xs text-gray-600 mt-1">= 1 √ó BW (Max 15 ml)</p>
                <p id="peditraceWarning" class="hidden text-xs text-red-600 mt-1 font-semibold">‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏ô 15 ml!</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Additive Section -->
      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">üß™ Additive</h2>
        <div class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="p-4 bg-orange-50 rounded-xl border border-orange-200">
              <h3 class="font-semibold text-orange-800 mb-3 flex items-center gap-2">
                <input type="checkbox" id="isPreterm" class="w-5 h-5 rounded cursor-pointer" onchange="calculateAll()">
                <label for="isPreterm" class="cursor-pointer">Preterm infant</label>
              </h3>
              <div id="zincOptions" class="space-y-3 hidden">
                <label class="flex items-start gap-3 p-3 bg-white rounded-lg cursor-pointer hover:bg-orange-100 border border-transparent hover:border-orange-300">
                  <input type="radio" name="zinc" value="yes" class="mt-1" onchange="calculateAll()">
                  <div class="flex-1">
                    <span class="font-medium text-gray-800 block">Add Zinc Sulfate</span>
                    <p class="text-xs text-gray-600">500 mcg/ml = 0.3 ml √ó BW</p>
                  </div>
                </label>
                <div id="zincVolumeDiv" class="hidden ml-8 p-3 bg-white rounded-lg">
                  <label class="block text-sm font-medium text-gray-700 mb-2">Zinc Volume</label>
                  <div class="relative">
                    <input type="number" id="zincVolume" step="0.01" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" inputmode="decimal" oninput="calculateAll()">
                    <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 text-sm">ml</span>
                  </div>
                </div>
                <label class="flex items-start gap-3 p-3 bg-white rounded-lg cursor-pointer hover:bg-orange-100 border border-transparent hover:border-orange-300">
                  <input type="radio" name="zinc" value="no" class="mt-1" onchange="calculateAll()">
                  <span class="font-medium text-gray-800">‡πÑ‡∏°‡πà‡πÄ‡∏ï‡∏¥‡∏° Zinc</span>
                </label>
              </div>
            </div>
            <div class="p-4 bg-pink-50 rounded-xl border border-pink-200">
              <h3 class="font-semibold text-pink-800 mb-3">üíâ Heparin</h3>
              <div class="space-y-3">
                <label class="flex items-start gap-3 p-3 bg-white rounded-lg cursor-pointer hover:bg-pink-100 border border-transparent hover:border-pink-300">
                  <input type="radio" name="heparin" value="yes" id="heparinYes" class="mt-1" onchange="calculateAll()">
                  <div class="flex-1">
                    <span class="font-medium text-gray-800 block">‡πÄ‡∏ï‡∏¥‡∏° Heparin</span>
                    <p class="text-xs text-gray-600">1 unit/ml = 1 √ó PN volume</p>
                  </div>
                </label>
                <div id="heparinValueDiv" class="hidden ml-8 p-3 bg-white rounded-lg">
                  <div class="flex items-center gap-2 mb-2">
                    <span class="text-sm font-medium text-gray-700">Heparin Units:</span>
                    <span id="heparinUnits" class="text-lg font-bold text-pink-700">0</span>
                    <span class="text-gray-600">units</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-sm font-medium text-gray-700">Heparin Volume:</span>
                    <span id="heparinVolume" class="text-lg font-bold text-pink-700">0.00</span>
                    <span class="text-gray-600">ml (√∑ 500)</span>
                  </div>
                </div>
                <label class="flex items-start gap-3 p-3 bg-white rounded-lg cursor-pointer hover:bg-pink-100 border border-transparent hover:border-pink-300">
                  <input type="radio" name="heparin" value="no" class="mt-1" checked onchange="calculateAll()">
                  <span class="font-medium text-gray-800">‡πÑ‡∏°‡πà‡πÄ‡∏ï‡∏¥‡∏° Heparin</span>
                </label>
              </div>
            </div>
          </div>
          <div class="p-4 bg-purple-50 rounded-xl border border-purple-200">
            <h3 class="font-semibold text-purple-800 mb-3">‚ûï Add ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£</label>
                <input type="text" id="additiveOtherName" placeholder="‡πÄ‡∏ä‡πà‡∏ô Taurine, L-Carnitine" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all" oninput="calculateAll()">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ï‡∏£</label>
                <div class="relative">
                  <input type="number" id="additiveOtherVolume" step="0.1" min="0" placeholder="0" class="w-full px-4 py-2.5 border border-gray-300 rounded-xl input-focus transition-all pr-12" inputmode="decimal" oninput="calculateAll()">
                  <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium">ml</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Composition Table -->
      <section class="bg-white rounded-2xl card-shadow p-6 animate-fade-in">
        <h2 class="section-title text-lg font-semibold text-gray-800 mb-4">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Order TPN</h2>
        <div class="overflow-x-auto rounded-xl border border-gray-200">
          <table class="w-full text-sm">
            <thead>
  <tr class="table-header text-white">
    <th class="px-4 py-3 text-left font-semibold rounded-tl-xl">‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</th>
    <th class="px-4 py-3 text-right font-semibold">‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ï‡∏£ (ml)</th>
    <th class="px-4 py-3 text-right font-semibold text-blue-200">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° (ml)</th>
    <th class="px-4 py-3 text-right font-semibold">‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà (kcal)</th>
    <th class="px-4 py-3 text-right font-semibold rounded-tr-xl">mOsmol/L</th>
  </tr>
</thead>
            <tbody id="compositionTable">
  <tr class="border-b border-gray-100 font-bold bg-gray-50">
    <td colspan="5" class="px-4 py-2 text-gray-800">Macronutrients</td>
  </tr>
  <tr class="border-b border-gray-100 hover:bg-gray-50">
    <td id="row-protein-name" class="px-4 py-2 pl-8 text-purple-700 font-medium">Protein Product</td>
    <td id="proteinVol" class="px-4 py-2 text-right font-mono text-gray-600">0.0</td>
    <td id="prep-proteinVol" class="px-4 py-2 text-right font-mono text-blue-600 bg-blue-50/30">0.0</td>
    <td id="proteinCal" class="px-4 py-2 text-right font-mono">0.0</td>
    <td id="proteinOsmol" class="px-4 py-2 text-right font-mono">0</td>
  </tr>
  <tr class="border-b border-gray-100 hover:bg-gray-50">
    <td class="px-4 py-2 pl-8 text-blue-700">50% Dextrose</td>
    <td id="dextroseVol" class="px-4 py-2 text-right font-mono text-gray-600">0.0</td>
    <td id="prep-dextroseVol" class="px-4 py-2 text-right font-mono text-blue-600 bg-blue-50/30 font-bold">0.0</td>
    <td id="dextroseCal" class="px-4 py-2 text-right font-mono">0.0</td>
    <td id="dextroseOsmol" class="px-4 py-2 text-right font-mono">0</td>
  </tr>

  <tr class="border-b border-gray-100 font-bold bg-red-50/50">
    <td colspan="5" class="px-4 py-2 text-red-800">üßÇ Electrolytes (ml)</td>
  </tr>
  <tr class="border-b border-gray-100 text-xs">
    <td class="px-4 py-1 pl-8">- Glycophos (P)</td>
    <td id="row-phos-vol" class="px-4 py-1 text-right font-mono text-gray-600">0.0</td>
    <td id="prep-phos-vol" class="px-4 py-1 text-right font-mono text-blue-600 bg-blue-50/30">0.0</td>
    <td class="text-right">-</td>
    <td id="row-phos-osmol" class="px-4 py-1 text-right font-mono">0</td>
  </tr>
  <tr class="border-b border-gray-100 text-xs">
    <td class="px-4 py-1 pl-8">- 3% NaCl (Na)</td>
    <td id="row-na-vol" class="px-4 py-1 text-right font-mono text-gray-600">0.0</td>
    <td id="prep-na-vol" class="px-4 py-1 text-right font-mono text-blue-600 bg-blue-50/30">0.0</td>
    <td class="text-right">-</td>
    <td id="row-na-osmol" class="px-4 py-1 text-right font-mono">0</td>
  </tr>
  <tr class="border-b border-gray-100 text-xs">
    <td class="px-4 py-1 pl-8">- KCl (K)</td>
    <td id="row-k-vol" class="px-4 py-1 text-right font-mono text-gray-600">0.0</td>
    <td id="prep-k-vol" class="px-4 py-1 text-right font-mono text-blue-600 bg-blue-50/30">0.0</td>
    <td class="text-right">-</td>
    <td id="row-k-osmol" class="px-4 py-1 text-right font-mono">0</td>
  </tr>
  <tr class="border-b border-gray-100 text-xs">
    <td class="px-4 py-1 pl-8">- 50% MgSO4 (Mg)</td>
    <td id="row-mg-vol" class="px-4 py-1 text-right font-mono text-gray-600">0.0</td>
    <td id="prep-mg-vol" class="px-4 py-1 text-right font-mono text-blue-600 bg-blue-50/30">0.0</td>
    <td class="text-right">-</td>
    <td id="row-mg-osmol" class="px-4 py-1 text-right font-mono">0</td>
  </tr>
  <tr class="border-b border-gray-100 text-xs">
    <td class="px-4 py-1 pl-8">- 10% Ca Gluconate (Ca)</td>
    <td id="row-ca-vol" class="px-4 py-1 text-right font-mono text-gray-600">0.0</td>
    <td id="prep-ca-vol" class="px-4 py-1 text-right font-mono text-blue-600 bg-blue-50/30">0.0</td>
    <td class="text-right">-</td>
    <td id="row-ca-osmol" class="px-4 py-1 text-right font-mono">0</td>
  </tr>

  <tr class="border-b border-gray-100 font-bold bg-green-50/50">
    <td colspan="5" class="px-4 py-2 text-green-800">üíä Vitamins & Trace Element (ml)</td>
  </tr>
  <tr class="border-b border-gray-100 text-xs">
    <td class="px-4 py-1 pl-8">- Soluvit N</td>
    <td id="row-soluvit-vol" class="px-4 py-1 text-right font-mono text-gray-600">0.0</td>
    <td id="prep-soluvit-vol" class="px-4 py-1 text-right font-mono text-blue-600 bg-blue-50/30">0.0</td>
    <td class="text-right">-</td>
    <td class="text-right">-</td>
  </tr>
  <tr class="border-b border-gray-100 text-xs">
    <td class="px-4 py-1 pl-8">- Peditrace</td>
    <td id="row-peditrace-vol" class="px-4 py-1 text-right font-mono text-gray-600">0.0</td>
    <td id="prep-peditrace-vol" class="px-4 py-1 text-right font-mono text-blue-600 bg-blue-50/30">0.0</td>
    <td class="text-right">-</td>
    <td class="text-right">-</td>
  </tr>

  <tr class="border-b border-gray-100 font-bold bg-orange-50/50">
    <td colspan="5" class="px-4 py-2 text-orange-800">üß™ Additives (ml)</td>
  </tr>
  <tr class="border-b border-gray-100 text-xs">
    <td class="px-4 py-1 pl-8">- Zinc Sulfate</td>
    <td id="row-zinc-vol" class="px-4 py-1 text-right font-mono text-gray-600">0.0</td>
    <td id="prep-zinc-vol" class="px-4 py-1 text-right font-mono text-blue-600 bg-blue-50/30">0.0</td>
    <td class="text-right">-</td>
    <td class="text-right">-</td>
  </tr>
  <tr class="border-b border-gray-100 text-xs">
    <td class="px-4 py-1 pl-8">- Heparin</td>
    <td id="row-heparin-vol" class="px-4 py-1 text-right font-mono text-gray-600">0.0</td>
    <td id="prep-heparin-vol" class="px-4 py-1 text-right font-mono text-blue-600 bg-blue-50/30">0.0</td>
    <td class="text-right">-</td>
    <td class="text-right">-</td>
  </tr>
  <tr class="border-b border-gray-100 text-xs">
    <td id="row-other-name" class="px-4 py-1 pl-8">- Other Additive</td>
    <td id="row-other-vol" class="px-4 py-1 text-right font-mono text-gray-600">0.0</td>
    <td id="prep-other-vol" class="px-4 py-1 text-right font-mono text-blue-600 bg-blue-50/30">0.0</td>
    <td class="text-right">-</td>
    <td class="text-right">-</td>
  </tr>

  <tr class="border-b border-gray-100 bg-blue-50/50">
    <td class="px-4 py-2 font-medium text-blue-700">üíß Sterile Water</td>
    <td class="px-4 py-2 text-right font-mono">
      <span id="waterVolDisplay" class="text-gray-600">0.0</span>
      <span id="waterLimitWarning" class="hidden block text-[10px] text-red-800 font-bold">‚ö†Ô∏è ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</span>
    </td>
    <td class="px-4 py-2 text-right font-mono bg-blue-50/30">
      <span id="prep-waterVol" class="text-blue-700 font-bold">0.0</span>
    </td>
    <td class="text-right">-</td>
    <td class="text-right">-</td>
  </tr>

  <tr class="bg-gray-800 text-white font-bold">
    <td class="px-4 py-3">‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td>
    <td class="px-4 py-3 text-right font-mono text-yellow-400">
      <span id="totalPNVol">0.0</span> <span class="text-[10px] ml-1">ml</span>
    </td>
    <td class="px-4 py-3 text-right font-mono text-cyan-300">
      <span id="totalPrepVolDisplay">0.0</span> <span class="text-[10px] ml-1">ml</span>
    </td>
    <td class="px-4 py-3 text-right font-mono">
      <span id="totalPNCal">0.0</span> <span class="text-[10px] ml-1 text-gray-400">kcal</span>
    </td>
    <td class="px-4 py-3 text-right font-mono">
      <span id="totalOsmol">0</span> <span class="text-[10px] ml-1 text-gray-400">mOsm/L</span>
    </td>
  </tr>
</tbody>
          </table>
        </div>
        <div id="prepSummary" class="mt-6 p-6 success-box rounded-xl border-2 border-green-200">
  <h4 class="font-bold text-green-800 mb-3 text-lg flex items-center gap-2">
    <span>üßà</span> ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Fat
  </h4>
  
  <div id="prepDetails" class="text-green-700 space-y-2 text-base">
     </div>
</div>
        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="p-4 bg-green-50 rounded-xl border border-green-200">
            <div class="text-sm text-green-600 mb-1">Total Calories</div>
            <div class="flex items-baseline gap-2">
              <span id="totalCalDisplay" class="text-2xl font-bold text-green-700">0.0</span>
              <span class="text-green-600">kcal/day</span>
            </div>
          </div>
          <div class="p-4 bg-blue-50 rounded-xl border border-blue-200">
            <div class="text-sm text-blue-600 mb-1">Calories per kg</div>
            <div class="flex items-baseline gap-2">
              <span id="calPerKg" class="text-2xl font-bold text-blue-700">0.0</span>
              <span class="text-blue-600">kcal/kg/day</span>
            </div>
          </div>
          <div class="p-4 bg-purple-50 rounded-xl border border-purple-200">
            <div class="text-sm text-purple-600 mb-1">Final Osmolarity</div>
            <div class="flex items-baseline gap-2">
              <span id="finalOsmol" class="text-2xl font-bold text-purple-700">0</span>
              <span class="text-purple-600">mOsmol/L</span>
            </div>
          </div>
        </div>
        <div id="osmolWarning" class="hidden mt-4 p-4 warning-box rounded-xl">
          <div class="flex items-center gap-2 text-amber-800">
            <span class="text-xl">‚ö†Ô∏è</span>
            <span class="font-medium">Osmolarity ‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Peripheral Line (> 900 mOsmol/L) ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÉ‡∏ä‡πâ Central Line</span>
          </div>
        </div>
      </section>
  
      <!-- Save Order Button -->
      <div class="flex gap-2 justify-end mt-10 mb-8">
        <button id="saveOrderBtn" onclick="saveOrder()" class="px-6 py-3 bg-green-600 text-white font-semibold rounded-xl hover:bg-green-700 transition-all flex items-center gap-2">
          <span>üíæ</span> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Order
        </button>
      </div>
    </main>
        </section>
    
      <!-- Footer -->
      <footer class="text-center py-6 text-gray-500 text-sm">
        <p>TPN Calculator for Pediatric Patients</p>
      </footer>
    </div>


  <script>
    // ========================================
    // TPN Calculator with Google Apps Script
    // ========================================
    
    // üîß Configuration
    const API_URL = 'https://script.google.com/macros/s/AKfycbzbm7odZSoVjhvnFRfY7Cb5kdyCi5gnxrhmoiQHROQy7tYmwsYolvyTKu575si9wgHtMw/exec';
    
    // Global variables
    let isVitalipidManual = false;
    let isRateManual = false;
  let isPhosNaManual = false, isNaVolManual = false, isKVolManual = false, isMgVolManual = false, isCaVolManual = false;
    let isSoluvitManual = false;
let isPeditraceManual = false;
    let isFlushManual = false; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á Script
    let isPhosVolManual = false;

    // ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢
const wardList = [
  "2‡∏Ñ", "2‡∏á", "3‡∏Å", "3‡∏Ñ", "3‡∏á", "3‡∏â", "4‡∏Å", "4‡∏Ñ", "5‡∏Ç", "6‡∏Å", "6‡∏Ç", 
  "AE1", "AE2", "AE3", "CCU", "CVT-ICU", "HOME PN", "IMC2‡∏á", "IMC3‡∏Ç", "IMC4‡∏Ç", 
  "MICU 1", "MICU 2", "NICU", "PICU", "PICU ‡∏®‡∏™‡∏Å.", "SCTU", "SICU 1", "SICU 2", 
  "‡∏Å‡∏ß.6/1", "‡∏Å‡∏ß.6/2", "‡∏Å‡∏ß.7/1", "‡∏Å‡∏ß.7/2", "‡∏™‡∏ß.1/11", "‡∏™‡∏ß.1/12", "‡∏™‡∏ß.1/13", 
  "‡∏™‡∏ß.1/14", "‡∏™‡∏ß.1/15", "‡∏™‡∏ß.1/8B", "‡∏™‡∏ß.1/8C", "‡∏™‡∏ß.1/9A", "‡∏™‡∏ß.1/9B", "‡∏™‡∏ß.1/9C"
];

function showWardList() {
  const dropdown = document.getElementById('wardDropdown');
  dropdown.classList.remove('hidden');
  renderWardOptions(wardList);
}

function filterWardList() {
  const searchTerm = document.getElementById('wardInput').value.toLowerCase();
  const filtered = wardList.filter(ward => ward.toLowerCase().includes(searchTerm));
  renderWardOptions(filtered);
}

function renderWardOptions(list) {
  const container = document.getElementById('wardOptions');
  if (list.length === 0) {
    container.innerHTML = '<div class="px-4 py-2 text-gray-500 text-sm">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
    return;
  }
  
  container.innerHTML = list.map(ward => `
    <div onclick="selectWard('${ward}')" 
      class="px-4 py-2 hover:bg-blue-50 cursor-pointer text-gray-700 text-sm transition-colors border-b border-gray-50 last:border-0">
      ${ward}
    </div>
  `).join('');
}

function selectWard(val) {
  document.getElementById('wardInput').value = val;
  document.getElementById('ward').value = val;
  document.getElementById('wardDropdown').classList.add('hidden');
  
  // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏™‡∏£‡∏∏‡∏õ (Summary) ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
  if (typeof calculateAll === "function") calculateAll();
}

// ‡∏õ‡∏¥‡∏î Dropdown ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô
document.addEventListener('click', function(e) {
  const wardContainer = document.getElementById('wardInput').parentElement;
  if (!wardContainer.contains(e.target)) {
    document.getElementById('wardDropdown').classList.add('hidden');
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÉ‡∏ô List ‡πÉ‡∏´‡πâ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏¥‡πâ‡∏á (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å List)
    const currentInput = document.getElementById('wardInput').value;
    if (!wardList.includes(currentInput)) {
      document.getElementById('wardInput').value = '';
      document.getElementById('ward').value = '';
    }
  }
});
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
async function fetchPatientName() {
    const hnInput = document.getElementById('hn');
    const nameInput = document.getElementById('patientName');
    const statusText = document.getElementById('searchStatus');
    const hnValue = hnInput.value.trim().toLowerCase();
    
    // --- ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç: ‡∏ñ‡πâ‡∏≤‡∏•‡∏ö HN ‡∏≠‡∏≠‡∏Å ‡πÉ‡∏´‡πâ‡∏•‡πâ‡∏≤‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏¥‡πâ‡∏á‡∏î‡πâ‡∏ß‡∏¢ ---
    if (hnValue === "") {
        nameInput.value = "";
        statusText.innerText = "";
        nameInput.classList.remove('border-blue-500', 'bg-blue-50');
        return;
    }

    if (hnValue.length >= 3) {
        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Loading
        statusText.innerText = "üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°...";
        statusText.className = "text-[11px] mt-1 font-medium text-blue-600 animate-pulse";
        
        try {
            const response = await fetch(`${API_URL}?action=getPatientName&hn=${hnValue}`);
            const result = await response.json();
            
            if (result.patient_name) {
                // ‡∏Å‡∏£‡∏ì‡∏µ‡∏´‡∏≤‡πÄ‡∏à‡∏≠
                nameInput.value = result.patient_name;
                statusText.innerText = "‚úÖ ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß";
                statusText.className = "text-[11px] mt-1 font-medium text-green-600";
                nameInput.classList.add('border-blue-500', 'bg-blue-50');
            } else {
                // ‡∏Å‡∏£‡∏ì‡∏µ‡∏´‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠
                statusText.innerText = "‚ùì ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏î‡∏¥‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ";
                statusText.className = "text-[11px] mt-1 font-medium text-amber-600";
                nameInput.classList.remove('border-blue-500', 'bg-blue-50');
                // ‡πÑ‡∏°‡πà‡∏•‡πâ‡∏≤‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏Ç‡∏¥‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà
            }
        } catch (error) {
            statusText.innerText = "‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á";
            statusText.className = "text-[11px] mt-1 font-medium text-red-600";
        }
    }
}

// ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ 'input' ‡πÅ‡∏ó‡∏ô 'blur' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå (‡∏ñ‡πâ‡∏≤‡∏ä‡πâ‡∏≤‡πÑ‡∏õ‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô blur ‡∏Ñ‡πà‡∏∞)
document.getElementById('hn').addEventListener('input', fetchPatientName);
    
    // ========== API Functions ==========

 async function saveOrder() {
    // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á
    const orderDate = document.getElementById('orderDate').value; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
    const hn = document.getElementById('hn').value;
    const patientName = document.getElementById('patientName').value;
    
    // ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏° orderDate
    if (!orderDate || !hn || !patientName) {
        alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:\n- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà Order TPN\n- HN\n- ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢");
        return;
    }
    // 2. ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏ô Google Sheets (41 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå)
    const data = {
        order_date: document.getElementById('orderDate').value,
        hn: hn,
        patient_name: patientName,
        ward: document.getElementById('ward').value,
        bw: document.getElementById('bw').value,
        route: document.querySelector('input[name="route"]:checked').value,
        
        // Targets
        total_volume: document.getElementById('totalVolume').value,
        protein_target: document.getElementById('proteinTarget').value,
        fat_target: document.getElementById('fatTarget').value,
        dextrose_percent: document.getElementById('dextrosePercent').value,
        phosphorus: document.getElementById('phosphorus').value,
        sodium: document.getElementById('sodium').value,
        potassium: document.getElementById('potassium').value,
        magnesium: document.getElementById('magnesium').value,
        calcium: document.getElementById('calcium').value,
        
        // Volumes (‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á)
        soluvit: document.getElementById('soluvit').value,
        peditrace: document.getElementById('peditrace').value,
        vitalipid: document.getElementById('vitalipid').value,
        zinc_added: document.querySelector('input[name="zinc"]:checked')?.value || 'no',
        zinc_volume: document.getElementById('zincVolume').value || 0,
        heparin_added: document.querySelector('input[name="heparin"]:checked')?.value || 'no',
        heparin_units: document.getElementById('heparinUnits').innerText,
        additive_other_name: document.getElementById('additiveOtherName').value,
        additive_other_volume: document.getElementById('additiveOtherVolume').value,
        is_preterm: document.getElementById('isPreterm').checked,
        protein_product: document.querySelector('input[name="proteinProduct"]:checked').value,
        fat_product: document.querySelector('input[name="fatProduct"]:checked').value,
        
        // Results
        pn_volume: document.getElementById('totalPNVol').innerText,
        fat_volume: document.getElementById('fatVolume').value,
        rate_tpn: document.getElementById('rateTPN').value,
        fat_rate: document.getElementById('manualFatDripRate').value,
        drip_duration: 24, // ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì PN/24
        prep_dextrose_vol: document.getElementById('prep-dextroseVol').innerText,
        prep_water_vol: document.getElementById('prep-waterVol').innerText,
        
        // Summary
        total_calories: document.getElementById('totalCalDisplay').innerText,
        cal_per_kg: document.getElementById('calPerKg').innerText,
        osmolarity: document.getElementById('finalOsmol').innerText.replace('~', '').trim(),
        prep_split: document.querySelector('input[name="prepSplit"]:checked').value,
        flush_option: document.querySelector('input[name="flush"]:checked').value,
        flush_volume: document.getElementById('flushVolume').value || 0
    };

    // 3. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzbm7odZSoVjhvnFRfY7Cb5kdyCi5gnxrhmoiQHROQy7tYmwsYolvyTKu575si9wgHtMw/exec';
    
    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏ã‡πâ‡∏≥
    const saveBtn = document.querySelector('button[onclick="saveOrder()"]');
    const originalBtnText = saveBtn.innerText;
    saveBtn.disabled = true;
    saveBtn.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";

    fetch(scriptURL, {
        method: 'POST',
        mode: 'no-cors', // ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CORS
        body: new URLSearchParams(data)
    })
    .then(() => {
        alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏£‡∏∞‡∏ö‡∏ö Dashboard ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡∏Ñ‡πà‡∏∞');
        saveBtn.disabled = false;
        saveBtn.innerText = originalBtnText;
        // (Optional) ‡∏™‡∏±‡πà‡∏á Reset ‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤ HN ‡∏´‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
    })
    .catch(error => {
        console.error('Error!', error.message);
        alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
        saveBtn.disabled = false;
        saveBtn.innerText = originalBtnText;
    });
}
    function showSaveMessage(message, type) {
      let existingMsg = document.getElementById('saveMessage');
      if (existingMsg) existingMsg.remove();

      const msgDiv = document.createElement('div');
      msgDiv.id = 'saveMessage';
      msgDiv.className = type === 'success' 
        ? 'fixed top-4 left-1/2 -translate-x-1/2 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-[9999] animate-fade-in'
        : 'fixed top-4 left-1/2 -translate-x-1/2 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-[9999] animate-fade-in';
      msgDiv.textContent = message;
      document.body.appendChild(msgDiv);

      setTimeout(() => msgDiv.remove(), type === 'success' ? 3000 : 5000);
    }

    // ========== Helper Functions ==========

    function roundToPlace(num, places) {
      const factor = Math.pow(10, places);
      return Math.round((num || 0) * factor) / factor;
    }

    // ========== Calculation Functions ==========

   function calculateAll() {
      const bw = parseFloat(document.getElementById('bw').value) || 0;
      const totalVolume = parseFloat(document.getElementById('totalVolume').value) || 0;
      const fatTarget = parseFloat(document.getElementById('fatTarget').value) || 0;
      const proteinTarget = parseFloat(document.getElementById('proteinTarget').value) || 0;
      const dextrosePercent = parseFloat(document.getElementById('dextrosePercent').value) || 0;
      
      // 1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Vitalipid Volume
      const vitalipidInput = document.getElementById('vitalipid');
      const vitalipidWarning = document.getElementById('vitalipidMaxWarning');
      const vitalipidFatValue = parseFloat(document.getElementById('vitalipidFatValue').value) || 0;

      if (!isVitalipidManual) {
        let autoVitalipid = bw * 4;
        if (autoVitalipid > 10) autoVitalipid = 10;
        vitalipidInput.value = roundToPlace(autoVitalipid, 1);
      }
      vitalipidWarning.classList.toggle('hidden', !(parseFloat(vitalipidInput.value) > 10));
      const vitalipidVolume = parseFloat(vitalipidInput.value) || 0;

      // 2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Net Fat
      let netFat = fatTarget;
      if (document.getElementById('deductVitalipid').checked) {
        netFat = Math.max(0, fatTarget - vitalipidFatValue);
      }
      document.getElementById('netFat').value = roundToPlace(netFat, 1);
      document.getElementById('fatDisplay').value = roundToPlace(netFat, 1);

      // 3. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Fat Volume
      const fatVolInput = document.getElementById('fatVolume');
      if (document.activeElement !== fatVolInput) {
     
      }
      const fatVolume = parseFloat(fatVolInput.value) || 0;
      
      // 4. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì PN Volume
      const pnVolume = Math.max(0, totalVolume - fatVolume - vitalipidVolume);
      document.getElementById('pnVolume').value = roundToPlace(pnVolume, 1);
      
      const pnFlush = parseFloat(document.getElementById('pnFlushVolume').value) || 0;
      const pnPrepVol = roundToPlace(pnVolume + pnFlush, 1);
      document.getElementById('pnPrepVolume').value = pnPrepVol;

      // 5. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Rate TPN & GIR
      const rateInput = document.getElementById('rateTPN');
      if (!isRateManual) {
        rateInput.value = roundToPlace(pnVolume / 24, 1);
      }
      const finalRate = parseFloat(rateInput.value) || 0;
      const gir = bw > 0 ? (finalRate * dextrosePercent) / (bw * 6) : 0;
      document.getElementById('girValue').textContent = roundToPlace(gir, 2);
      document.getElementById('girWarning').classList.toggle('hidden', !(gir > 12));

      // 6. Electrolytes (Na from P, Na, K, Mg, Ca)
      const phosphorus = parseFloat(document.getElementById('phosphorus').value) || 0;
      const sodium = parseFloat(document.getElementById('sodium').value) || 0;
      const potassium = parseFloat(document.getElementById('potassium').value) || 0;
      const magnesium = parseFloat(document.getElementById('magnesium').value) || 0;
      const calcium = parseFloat(document.getElementById('calcium').value) || 0;

      // ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Phosphorus
const phosInput = document.getElementById('phosvol');
if (!isPhosVolManual) {
    phosInput.value = roundToPlace(phosphorus * bw, 1);
}
const phosVolume = parseFloat(phosInput.value) || 0;
      document.getElementById('phosvol').textContent = phosVolume;
      
      const phoNaInput = document.getElementById('phoNa');
      if (!isPhosNaManual) { phoNaInput.value = roundToPlace(2 * phosVolume, 1); }
      const phosNa = parseFloat(phoNaInput.value) || 0;

      const naInput = document.getElementById('navol');
      if (!isNaVolManual) { naInput.value = roundToPlace(Math.max(0, (sodium * bw) - phosNa) / 0.5, 1); }
      const naClVolume = parseFloat(naInput.value) || 0;

      const kInput = document.getElementById('kvol');
      if (!isKVolManual) { kInput.value = roundToPlace((potassium * bw) / 2, 1); }
      const kVolume = parseFloat(kInput.value) || 0;

      const mgInput = document.getElementById('mgvol');
      if (!isMgVolManual) { mgInput.value = roundToPlace((magnesium * bw) / 2, 2); }
      const mgVolume = parseFloat(mgInput.value) || 0;

      const caInput = document.getElementById('cavol');
      const caWarning = document.getElementById('caMaxWarning');

      if (!isCaVolManual) {
          let autoCaVol = calcium * bw;
          if (autoCaVol > 10) {
              caInput.value = 10;
              caWarning.classList.remove('hidden');
          } else {
              caInput.value = roundToPlace(autoCaVol, 1);
              caWarning.classList.add('hidden');
          }
      } else {
          const manualCaVal = parseFloat(caInput.value) || 0;
          caWarning.classList.toggle('hidden', !(manualCaVal > 10));
      }
      const caVolume = parseFloat(caInput.value) || 0;
      const electrolytesVolume = phosVolume + naClVolume + kVolume + mgVolume + caVolume;

      // 7. Vitamins & Trace (‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏î‡πâ)
      const soluvitInput = document.getElementById('soluvit');
      if (!isSoluvitManual) {
          soluvitInput.value = roundToPlace(Math.min(bw * 1, 10), 1);
      }
      const soluvitVolume = parseFloat(soluvitInput.value) || 0;

      const peditraceInput = document.getElementById('peditrace');
      if (!isPeditraceManual) {
          peditraceInput.value = roundToPlace(Math.min(bw * 1, 15), 1);
      }
      const peditraceVolume = parseFloat(peditraceInput.value) || 0;

      document.getElementById('soluvitWarning').classList.toggle('hidden', !(soluvitVolume > 10));
      document.getElementById('peditraceWarning').classList.toggle('hidden', !(peditraceVolume > 15));

      // 8. Additives (Zinc, Heparin, Other)
      let additivesVolume = 0;
      const isPreterm = document.getElementById('isPreterm').checked;
      document.getElementById('zincOptions').classList.toggle('hidden', !isPreterm);
      
      let zincVolume = 0;
      if (isPreterm && document.querySelector('input[name="zinc"]:checked')?.value === 'yes') {
        const zincInput = document.getElementById('zincVolume');
        zincVolume = parseFloat(zincInput.value) || 0;
        if (document.activeElement !== zincInput && zincVolume === 0) { 
          zincVolume = roundToPlace(0.3 * bw, 2); 
          zincInput.value = zincVolume;
        }
        document.getElementById('zincVolumeDiv').classList.remove('hidden');
      } else {
        document.getElementById('zincVolumeDiv').classList.add('hidden');
      }

      let heparinVolume = 0;
      if (document.querySelector('input[name="heparin"]:checked')?.value === 'yes') {
        const hepUnits = roundToPlace(1 * pnVolume, 0);
        heparinVolume = roundToPlace(hepUnits / 500, 2);
        document.getElementById('heparinUnits').textContent = hepUnits;
        document.getElementById('heparinVolume').textContent = heparinVolume.toFixed(2);
        document.getElementById('heparinValueDiv').classList.remove('hidden');
      } else {
        document.getElementById('heparinValueDiv').classList.add('hidden');
      }

      const otherVol = parseFloat(document.getElementById('additiveOtherVolume').value) || 0;
      additivesVolume = zincVolume + heparinVolume + otherVol;

      // 9. Protein & Dextrose
      const protProduct = document.querySelector('input[name="proteinProduct"]:checked').value;
      const proteinGrams = bw * proteinTarget;
     const proteinVolume = parseFloat(document.getElementById('proteinVolInput').value) || 0;
      const dextroseVolume = roundToPlace((dextrosePercent * pnVolume * 2) / 100, 1);

      // 10. Water (Net)
      const allSubstances = proteinVolume + dextroseVolume + electrolytesVolume + soluvitVolume + peditraceVolume + zincVolume + otherVol;
      const waterVolume = pnVolume - allSubstances;

      // 11. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ï‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ ‡πÅ‡∏•‡∏∞ ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå)
     const selectedProt = document.querySelector('input[name="proteinProduct"]:checked');
const protName = document.querySelector(`label[for="${selectedProt.id}"]`).textContent;
document.getElementById('row-protein-name').textContent = protName;

      const otherNameInput = document.getElementById('additiveOtherName').value;
      document.getElementById('row-other-name').textContent = otherNameInput ? "- " + otherNameInput : "- Other Additive";

      document.getElementById('proteinVol').textContent = roundToPlace(proteinVolume, 1);
      document.getElementById('proteinCal').textContent = roundToPlace(proteinGrams * 4, 1);
      document.getElementById('dextroseVol').textContent = roundToPlace(dextroseVolume, 1);
      document.getElementById('dextroseCal').textContent = roundToPlace((dextrosePercent * pnVolume / 100) * 3.4, 1);
      
      document.getElementById('row-phos-vol').textContent = phosVolume;
      document.getElementById('row-na-vol').textContent = naClVolume;
      document.getElementById('row-k-vol').textContent = kVolume;
      document.getElementById('row-mg-vol').textContent = mgVolume;
      document.getElementById('row-ca-vol').textContent = caVolume;
      
      document.getElementById('row-soluvit-vol').textContent = soluvitVolume;
      document.getElementById('row-peditrace-vol').textContent = peditraceVolume;
      document.getElementById('row-zinc-vol').textContent = zincVolume;
      document.getElementById('row-heparin-vol').textContent = heparinVolume;
      document.getElementById('row-other-vol').textContent = otherVol;

     // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏£‡∏Å (‡∏™‡∏∏‡∏ó‡∏ò‡∏¥)
const waterVolDisplay = document.getElementById('waterVolDisplay');
waterVolDisplay.textContent = roundToPlace(waterVolume, 1);

if (waterVolume < 0) {
    waterVolDisplay.style.color = "#991b1b"; // ‡πÅ‡∏î‡∏á‡πÄ‡∏Ç‡πâ‡∏°
    waterVolDisplay.style.fontWeight = "900"; // ‡∏´‡∏ô‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©
} else {
    waterVolDisplay.style.color = "#4b5563"; // ‡∏™‡∏µ‡∏õ‡∏Å‡∏ï‡∏¥
    waterVolDisplay.style.fontWeight = "400";
}

      // 12. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Column "‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°" (‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ pnPrepVol)
      const prepDextroseVol = roundToPlace((dextrosePercent * pnPrepVol * 2) / 100, 1);
      document.getElementById('prep-dextroseVol').textContent = prepDextroseVol;

      document.getElementById('prep-proteinVol').textContent = roundToPlace(proteinVolume, 1);
      document.getElementById('prep-phos-vol').textContent = phosVolume;
      document.getElementById('prep-na-vol').textContent = naClVolume;
      document.getElementById('prep-k-vol').textContent = kVolume;
      document.getElementById('prep-mg-vol').textContent = mgVolume;
      document.getElementById('prep-ca-vol').textContent = caVolume;
      document.getElementById('prep-soluvit-vol').textContent = soluvitVolume;
      document.getElementById('prep-peditrace-vol').textContent = peditraceVolume;
      document.getElementById('prep-zinc-vol').textContent = zincVolume;
      document.getElementById('prep-heparin-vol').textContent = heparinVolume;
      document.getElementById('prep-other-vol').textContent = otherVol;

     // ‡∏´‡∏±‡∏Å‡∏•‡∏ö‡∏¢‡∏≠‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° (‡πÉ‡∏ä‡πâ prepDextroseVol) ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏° Heparin ‡πÄ‡∏ä‡πà‡∏ô‡∏Å‡∏±‡∏ô
const allSubstancesPrep = proteinVolume + prepDextroseVol + electrolytesVolume + soluvitVolume + peditraceVolume + zincVolume + otherVol;
const prepWaterVol = pnPrepVol - allSubstancesPrep;

      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏™‡∏≠‡∏á (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°)
const prepWaterDisplay = document.getElementById('prep-waterVol');
const waterWarning = document.getElementById('waterLimitWarning');

prepWaterDisplay.textContent = roundToPlace(prepWaterVol, 1);

if (prepWaterVol < 0) {
    prepWaterDisplay.className = "text-red-600 font-black";
    waterWarning.classList.remove('hidden'); // ‡πÇ‡∏ä‡∏ß‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "‚ö†Ô∏è ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ" ‡πÅ‡∏Ñ‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
} else {
    prepWaterDisplay.className = "text-blue-700 font-bold";
    waterWarning.classList.add('hidden');
}

      // ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°
      document.getElementById('totalPNVol').textContent = roundToPlace(pnVolume, 1);
      document.getElementById('totalPrepVolDisplay').textContent = roundToPlace(pnPrepVol, 1);
      
      const totalPNCal = (proteinGrams * 4) + ((dextrosePercent * pnVolume / 100) * 3.4);
      document.getElementById('totalPNCal').textContent = roundToPlace(totalPNCal, 1);
      
      const totalCal = totalPNCal + (bw * netFat * 10);
      document.getElementById('totalCalDisplay').textContent = roundToPlace(totalCal, 1);
      document.getElementById('calPerKg').textContent = bw > 0 ? roundToPlace(totalCal / bw, 1) : '0.0';

      // Osmolarity
      const protOsmol = pnPrepVol > 0 ? (proteinGrams * 10 * 1000 / pnPrepVol) : 0;
      const dexOsmol = pnPrepVol > 0 ? ((dextrosePercent * pnVolume / 100) * 5 * 1000 / pnPrepVol) : 0;
      const naTotalMeq = phosNa + (naClVolume * 0.5); 
      const naOsmol = pnPrepVol > 0 ? (2 * naTotalMeq * 1000 / pnPrepVol) : 0;
      const kOsmol = pnPrepVol > 0 ? (2 * (potassium * bw) * 1000 / pnPrepVol) : 0;
      const mgOsmol = pnPrepVol > 0 ? (mgVolume * 4 * 1000 / pnPrepVol) : 0; //
      const caOsmol = pnPrepVol > 0 ? (caVolume * 0.651 * 1000 / pnPrepVol) : 0; //

      // 3. ‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏£‡∏ß‡∏° Mg ‡πÅ‡∏•‡∏∞ Ca ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢)
      const totalOsmolValue = Math.round(protOsmol + dexOsmol + naOsmol + kOsmol + mgOsmol + caOsmol);
      document.getElementById('proteinOsmol').textContent = "~ " + Math.round(protOsmol);
      document.getElementById('dextroseOsmol').textContent = "~ " + Math.round(dexOsmol);
      document.getElementById('row-na-osmol').textContent = "~ " + Math.round(naOsmol);
      document.getElementById('row-k-osmol').textContent = "~ " + Math.round(kOsmol);
     // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡∏≠‡∏á Mg ‡πÅ‡∏•‡∏∞ Ca ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡πà‡∏∞
      document.getElementById('row-mg-osmol').textContent = "~ " + Math.round(mgOsmol);
      document.getElementById('row-ca-osmol').textContent = "~ " + Math.round(caOsmol);
      document.getElementById('totalOsmol').textContent = "~ " + totalOsmolValue;
      document.getElementById('finalOsmol').textContent = "~ " + totalOsmolValue;

      const currentRoute = document.querySelector('input[name="route"]:checked').value;
      const osmolWarningBox = document.getElementById('osmolWarning');
      osmolWarningBox.classList.toggle('hidden', !(currentRoute === 'peripheral' && totalOsmolValue > 900));

      calculateFatAdmin();
      updateOrderSummary();
    }

   function calculateFatAdmin() {
    // 1. ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ Volume ‡∏ï‡πà‡∏≤‡∏á‡πÜ
    const fatVolume = parseFloat(document.getElementById('fatVolume').value) || 0;
    const vitalipidVolume = parseFloat(document.getElementById('vitalipid').value) || 0;
    const currentWard = document.getElementById('ward').value; // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ Ward ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
    const flushRadioCustom = document.querySelector('input[name="flush"][value="custom"]');
    const flushInput = document.getElementById('flushVolume');

    // --- ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Drip Rate ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ (Fat + Vit) / 22 ---
    const recommendedRate = roundToPlace((fatVolume + vitalipidVolume) / 22, 1);
    const rateLabel = document.getElementById('autoFatRateLabel');
    if (rateLabel) {
        rateLabel.textContent = `(‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ = ${recommendedRate} ml/hr)`;
    }

    // 2. Logic ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Ward ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ (2‡∏á, 3‡∏á, IMC2‡∏á)
    const specialWards = ["2‡∏á", "3‡∏á", "IMC2‡∏á"];
    if (specialWards.includes(currentWard) && !isFlushManual) {
        const sumFatVit = fatVolume + vitalipidVolume;
        
        // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Custom ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
        flushRadioCustom.checked = true;
        
        if (sumFatVit <= 39) {
            flushInput.value = 6;
        } else {
            flushInput.value = 30;
        }
    }

    // 3. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏•‡∏£‡∏ß‡∏°
    const flushOption = document.querySelector('input[name="flush"]:checked').value;
    const flushVolume = flushOption === 'custom' ? (parseFloat(flushInput.value) || 0) : 0;
    const prepSplit = document.querySelector('input[name="prepSplit"]:checked').value;
    const manualRate = document.getElementById('manualFatDripRate').value || '0.0';
    
   const selectedFat = document.querySelector('input[name="fatProduct"]:checked');
const fatLabelElement = document.querySelector(`label[for="${selectedFat.id}"]`);
const fatName = fatLabelElement ? fatLabelElement.textContent : "Fat Emulsion";
   
    
    const totalVolPlusFlush = fatVolume + flushVolume;
    const grandTotalFatVit = totalVolPlusFlush + vitalipidVolume;
    const fatCalories = fatVolume * 2; 

    document.getElementById('totalFatPlusVitalipid').value = roundToPlace(grandTotalFatVit, 1);

    // 4. ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
    let prepText = `
        <p>‚Ä¢ <strong>${fatName}</strong>: ${roundToPlace(fatVolume, 1)} ml + ‡∏£‡∏ß‡∏°‡πÑ‡∏•‡πà‡∏™‡∏≤‡∏¢ (${roundToPlace(flushVolume, 0)} ml): <strong>${roundToPlace(totalVolPlusFlush, 1)}</strong> ml</p>
        <p>‚Ä¢ Vitalipid¬Æ: <strong>${roundToPlace(vitalipidVolume, 1)}</strong> ml</p>
        <p>‚Ä¢ Total Volume Fat + ‡πÑ‡∏•‡πà‡∏™‡∏≤‡∏¢ + Vitalipid: <span class="text-lg font-bold">${roundToPlace(grandTotalFatVit, 1)}</span> ml</p>
        <p>‚Ä¢ <strong>Calories from fat:</strong> <span class="text-amber-700 font-bold">${roundToPlace(fatCalories, 1)}</span> kcal</p>
    `;

    if (prepSplit === 'split') {
        prepText += `<p>‚Ä¢ <strong>‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°:</strong> ${roundToPlace(grandTotalFatVit / 2, 1)} ml √ó 2 syringe/‡∏Ç‡∏ß‡∏î</p>`;
    } else {
        prepText += `<p>‚Ä¢ <strong>‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°:</strong> ‡πÑ‡∏°‡πà‡πÅ‡∏ö‡πà‡∏á</p>`;
    }
    
    prepText += `<p>‚Ä¢ <strong>Drip Rate:</strong> <span class="text-blue-700 font-bold">${manualRate}</span> ml/hr</p>`;
    document.getElementById('prepDetails').innerHTML = prepText;

    if (typeof updateOrderSummary === "function") updateOrderSummary();
}
// ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç Ward ‡πÉ‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô calculateFatAdmin ‡∏Ñ‡πà‡∏∞
if (specialWards.includes(currentWard) && !isFlushManual) {
    const sumFatVit = fatVolume + vitalipidVolume;
    flushRadioCustom.checked = true;
    
    if (sumFatVit <= 39) {
        flushInput.value = 6;
    } else {
        flushInput.value = 30;
    }
    
    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏à‡πã‡∏á: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á"
    flushInput.classList.remove('bg-blue-50');
    flushInput.classList.add('bg-amber-50', 'border-amber-300'); 
} else if (isFlushManual) {
    // ‡∏ñ‡πâ‡∏≤‡∏Ç‡∏¥‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤ "‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏Ç‡∏¥‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á"
    flushInput.classList.remove('bg-amber-50', 'border-amber-300');
    flushInput.classList.add('bg-blue-50', 'border-blue-400');
}
    function updateOrderSummary() {
      const orderDate = document.getElementById('orderDate').value;
      const hn = document.getElementById('hn').value || '-';
      const patientName = document.getElementById('patientName').value || '-';
      const ward = document.getElementById('ward').value || '-';
      const route = document.querySelector('input[name="route"]:checked').value;
      const bw = parseFloat(document.getElementById('bw').value) || 0;
      const pnVolume = parseFloat(document.getElementById('pnVolume').value) || 0;
      const rateTPN = parseFloat(document.getElementById('rateTPN').value) || 0;
      const proteinTarget = parseFloat(document.getElementById('proteinTarget').value) || 0;
      const netFat = parseFloat(document.getElementById('netFat').value) || 0;
      const dextrosePercent = parseFloat(document.getElementById('dextrosePercent').value) || 0;
      const gir = parseFloat(document.getElementById('girValue').textContent) || 0;
      const vitalipid = parseFloat(document.getElementById('vitalipid').value) || 0;
      const proteinProduct = document.querySelector('input[name="proteinProduct"]:checked');
      const fatProduct = document.querySelector('input[name="fatProduct"]:checked');
      const totalCal = parseFloat(document.getElementById('totalCalDisplay').textContent) || 0;
      const calPerKg = parseFloat(document.getElementById('calPerKg').textContent) || 0;
      
      const proteinProductName = proteinProduct.parentElement.querySelector('.font-medium').textContent;
      const fatProductName = fatProduct.parentElement.querySelector('.font-medium').textContent;
      
      const formattedDate = orderDate ? new Date(orderDate).toLocaleDateString('th-TH', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      }) : '-';
      
      const summaryHTML = `
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="space-y-2">
            <p><span class="text-blue-200">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</span> ${formattedDate}</p>
            <p><span class="text-blue-200">üè• HN:</span> ${hn}</p>
            <p><span class="text-blue-200">üë§ ‡∏ä‡∏∑‡πà‡∏≠:</span> ${patientName}</p>
            <p><span class="text-blue-200">üõèÔ∏è Ward:</span> ${ward}</p>
            <p><span class="text-blue-200">üíâ Route:</span> ${route === 'central' ? 'Central Line' : 'Peripheral Line'}</p>
          </div>
          <div class="space-y-2">
            <p><span class="text-blue-200">‚öñÔ∏è ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å:</span> ${bw} kg</p>
            <p><span class="text-blue-200">üíß PN Volume:</span> ${roundToPlace(pnVolume, 1)} ml</p>
            <p><span class="text-blue-200">‚è±Ô∏è Rate:</span> ${roundToPlace(rateTPN, 1)} ml/hr</p>
            <p><span class="text-blue-200">üî• Total Cal:</span> ${roundToPlace(totalCal, 1)} kcal (${roundToPlace(calPerKg, 1)} kcal/kg/day)</p>
          </div>
        </div>
        <hr class="border-blue-400/30 my-3">
        <div class="space-y-2">
          <p><span class="text-blue-200">ü•© Protein:</span> ${proteinTarget} g/kg/day (${proteinProductName})</p>
          <p><span class="text-blue-200">üßà Fat:</span> ${roundToPlace(netFat, 1)} g/kg/day (${fatProductName})</p>
          <p><span class="text-blue-200">üç¨ Dextrose:</span> ${dextrosePercent}%</p>
          <p><span class="text-blue-200">üìä GIR:</span> ${roundToPlace(gir, 2)} mg/kg/min</p>
          <p><span class="text-blue-200">üíä Vitalipid-N Infant:</span> ${roundToPlace(vitalipid, 1)} ml</p>
        </div>
      `;
      
      document.getElementById('orderSummary').innerHTML = summaryHTML;
    }

    function resetForm() {
      isPhosVolManual = false; // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Manual
document.getElementById('phosvol').value = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á
  // 1. ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
  document.getElementById('orderDate').valueAsDate = new Date();
  document.getElementById('hn').value = '';
  document.getElementById('patientName').value = '';
  document.getElementById('wardInput').value = ''; 
  document.getElementById('ward').value = '';      

  // 2. ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Manual Flags ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô false
  isPhosNaManual = false;
  isNaVolManual = false;
  isKVolManual = false;
  isMgVolManual = false;
  isCaVolManual = false;
  isRateManual = false;
  isVitalipidManual = false;
  isSoluvitManual = false;
  isPeditraceManual = false;
  isFlushManual = false;

  // 3. ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô Inputs
  const inputsToClear = [
    'bw', 'totalVolume', 'fatTarget', 'proteinTarget', 'dextrosePercent',
    'phosphorus', 'sodium', 'potassium', 'magnesium', 'calcium',
    'flushVolume', 'vitalipid', 'soluvit', 'peditrace', 'zincVolume',
    'manualFatDripRate', 'additiveOtherName', 'additiveOtherVolume', 'rateTPN'
  ];
  inputsToClear.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });

  // 4. ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ Default ‡πÉ‡∏´‡πâ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞
  document.getElementById('pnFlushVolume').value = 30;
  document.getElementById('vitalipidFatValue').value = 0.4;
  document.getElementById('deductVitalipid').checked = false;
  document.getElementById('isPreterm').checked = false;

  // 5. ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ Radio Buttons
  document.querySelector('input[name="route"][value="central"]').checked = true;
  document.querySelector('input[name="proteinProduct"][value="aminoven"]').checked = true;
  document.querySelector('input[name="fatProduct"][value="smof"]').checked = true;
  document.querySelector('input[name="flush"][value="none"]').checked = true;
  document.querySelector('input[name="prepSplit"][value="none"]').checked = true;
  document.querySelector('input[name="heparin"][value="no"]').checked = true;
  document.querySelector('input[name="zinc"][value="no"]').checked = true;

  // 6. ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ (Composition Table)
  const tableCells = [
    'proteinVol', 'prep-proteinVol', 'proteinCal', 'proteinOsmol',
    'dextroseVol', 'prep-dextroseVol', 'dextroseCal', 'dextroseOsmol',
    'row-phos-vol', 'prep-phos-vol', 'row-phos-osmol',
    'row-na-vol', 'prep-na-vol', 'row-na-osmol',
    'row-k-vol', 'prep-k-vol', 'row-k-osmol',
    'row-mg-vol', 'prep-mg-vol', 'row-mg-osmol',
    'row-ca-vol', 'prep-ca-vol', 'row-ca-osmol',
    'row-soluvit-vol', 'prep-soluvit-vol',
    'row-peditrace-vol', 'prep-peditrace-vol',
    'row-zinc-vol', 'prep-zinc-vol',
    'row-heparin-vol', 'prep-heparin-vol',
    'row-other-vol', 'prep-other-vol',
    'waterVolDisplay', 'prep-waterVol',
    'totalPNVol', 'totalPrepVolDisplay', 'totalPNCal', 'totalOsmol'
  ];
  tableCells.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.textContent = '0.0';
  });

  // 7. ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î
  document.getElementById('totalCalDisplay').textContent = '0.0';
  document.getElementById('calPerKg').textContent = '0.0';
  document.getElementById('finalOsmol').textContent = '0';
  document.getElementById('girValue').textContent = '0.00';
  document.getElementById('heparinUnits').textContent = '0';
  document.getElementById('heparinVolume').textContent = '0.00';
  document.getElementById('phosvol').textContent = '0.0';

  // 8. ‡∏ã‡πà‡∏≠‡∏ô Warning ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ
  const elementsToHide = [
    'girWarning', 'osmolWarning', 'caMaxWarning', 'vitalipidMaxWarning',
    'soluvitWarning', 'peditraceWarning', 'waterLimitWarning',
    'zincOptions', 'zincVolumeDiv', 'heparinValueDiv'
  ];
  elementsToHide.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.classList.add('hidden');
  });

  // 9. ‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏Ç‡∏≠‡∏á input flush (‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡πÑ‡∏ß‡πâ)
  const flushInput = document.getElementById('flushVolume');
  flushInput.classList.remove('bg-amber-50', 'border-amber-300', 'bg-blue-50', 'border-blue-400');
  flushInput.classList.add('bg-blue-50', 'border-blue-200');

  // 10. ‡∏™‡∏±‡πà‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ UI ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
  calculateAll();
  
  // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡∏ö‡∏ô‡∏™‡∏∏‡∏î
  window.scrollTo({ top: 0, behavior: 'smooth' });
  console.log("üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞");
}

    // ========== Event Listeners ==========

    document.querySelectorAll('input[name="route"]').forEach(radio => {
      radio.addEventListener('change', calculateAll);
    });

    // ========== Initialize ==========

    document.addEventListener('DOMContentLoaded', () => {
      console.log('üöÄ TPN Calculator ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
      console.log('üì° ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö:', API_URL);
      document.getElementById('orderDate').valueAsDate = new Date();
      calculateAll();
    });
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡πá‡∏≠‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡πà‡∏≤ Vitalipid ‡πÄ‡∏≠‡∏á
function handleVitalipidManualChange() {
  isVitalipidManual = true; 
  calculateAll();
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡πá‡∏≠‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡πà‡∏≤ Rate ‡πÄ‡∏≠‡∏á
function handleRateManualChange() {
  isRateManual = true; 
  calculateAll();
}
function calculateFatLogic(source) {
    const bw = parseFloat(document.getElementById('bw').value) || 0;
    const isDeduct = document.getElementById('deductVitalipid').checked;
    const vFatVal = parseFloat(document.getElementById('vitalipidFatValue').value) || 0.4;
    const fConc = 0.20; // 20% Lipid
  const fatNameCell = document.getElementById('row-fat-name'); // ‡∏´‡∏£‡∏∑‡∏≠ id ‡∏Ç‡∏≠‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠ Fat ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
if (fatNameCell) fatNameCell.textContent = "- " + fatName;
    
    let fTarget = parseFloat(document.getElementById('fatTarget').value) || 0;
    let fVol = parseFloat(document.getElementById('fatVolume').value) || 0;
    let netFat = 0;

    if (source === 'fat_dose') {
        netFat = isDeduct ? Math.max(0, fTarget - vFatVal) : fTarget;
        fVol = (netFat * bw) / fConc;
        document.getElementById('fatVolume').value = roundToPlace(fVol, 1);
    } else if (source === 'fat_vol') {
        netFat = (fVol * fConc) / (bw > 0 ? bw : 1);
        fTarget = isDeduct ? netFat + vFatVal : netFat;
        document.getElementById('fatTarget').value = roundToPlace(fTarget, 1);
    }
    
    document.getElementById('netFat').value = roundToPlace(netFat, 1);
    calculateAll(); // ‡∏™‡∏±‡πà‡∏á‡∏£‡∏±‡∏ô calculateAll ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ç‡∏¥‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ
}

function calculateProteinLogic(source) {
    const bw = parseFloat(document.getElementById('bw').value) || 0;
    const protProduct = document.querySelector('input[name="proteinProduct"]:checked').value;
    // 15% Aminoplasmal ‡∏Ñ‡∏∑‡∏≠ 0.15, ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ñ‡∏∑‡∏≠ 10% (0.10)
    const pConc = protProduct === 'aminoplasmal' ? 0.15 : 0.10;
    
    let pDose = parseFloat(document.getElementById('proteinTarget').value) || 0;
    let pGrams = parseFloat(document.getElementById('proteinGrams').value) || 0;
    let pVol = parseFloat(document.getElementById('proteinVolInput').value) || 0;

    if (source === 'prot_dose') {
        pGrams = pDose * bw;
        pVol = pGrams / pConc;
    } else if (source === 'prot_grams') {
        pDose = bw > 0 ? pGrams / bw : 0;
        pVol = pGrams / pConc;
    } else if (source === 'prot_vol') {
        pGrams = pVol * pConc;
        pDose = bw > 0 ? pGrams / bw : 0;
    }

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ Input
    if (source !== 'prot_dose') document.getElementById('proteinTarget').value = roundToPlace(pDose, 1);
    if (source !== 'prot_grams') document.getElementById('proteinGrams').value = roundToPlace(pGrams, 2);
    if (source !== 'prot_vol') document.getElementById('proteinVolInput').value = roundToPlace(pVol, 1);
    
    calculateAll(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ
}
  </script>
</body>
</html>




